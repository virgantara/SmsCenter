// jQuery icontains
jQuery.expr[":"].icontains=function(e,t,n){return jQuery(e).text().toUpperCase().indexOf(n[3].toUpperCase())>=0};(function(e){jQuery.widget("multicomboboxui.multicombobox",{options:{buttonText:"+",isOpen:!1,hideElement:!0,closeAfterSelect:!0,duration:200,txtboxValue:"",callback:null},_create:function(){var t=this.element,n=this._crateComboBox();this.combobox=e(n);this._casheElements();this._bindUIActions();t.after(this.combobox);this._refreshSelected();this._refresh()},_refresh:function(){},_destroy:function(){this.combobox.remove();this.element.show()},_crateLi:function(e,t){return'	<li data-value="'+e+'">'+'<span data-value="'+e+'">'+t+"</span>"+"</li>\n"},_crateLis:function(t){var n=this,r=[];e.each(t,function(t,i){var s=e(i),o=n._crateLi(s.val(),s.text());r.push(o)});return r.join("")},_crateComboBox:function(){var e=this.element,t=this.options,n=this._crateLis(e.children("option")),r="";r+='<div class="multicombobox">\n';r+='	<input type="text" value="'+this.options.txtboxValue+'" class="txtbox">\n';r+='	<a href="#" class="txtbox-btn">'+t.buttonText+"</a>\n";r+='	<input type="text" value="iefix" style="display:none" />';r+="</div>\n";r+='<ul class="multicombobox-options">\n';r+=n;r+="</ul>";r+='<ul class="selected-list">';r+=n;r+="</ul>";return r},_openClose:function(e){e&&e.preventDefault();this.cashed[".combobox-options"].slideToggle(this.options.duration);this.cashed[".txtbox"].focus()},_refreshSelected:function(){var t=this.element.val(),n=this.cashed[".selected-list"];this.cashed[".selected-list li"].hide();t!==null&&e.each(t,function(e,t){n.find("[data-value="+t+"]").show()})},_selectLi:function(t){var n;t.target?n=e(t.target):n=t;var r=n.data("value");this.cashed[".txtbox"].val("");this.options.closeAfterSelect&&this._openClose();this.element.find("option[value="+r+"]").prop("selected",!0);this._refreshSelected();this._autocomplete();this._trigger("add")},_autocomplete:function(){var e=this.cashed[".txtbox"].val(),t=null;e!==""&&(t=this.cashed[".combobox-options li"].find("span:icontains("+e+")"));if(t){this.cashed[".combobox-options"].show();this.cashed[".combobox-options li"].show();this.cashed[".combobox-options li"].children().show();var n=this.cashed[".combobox-options li"].children().not(t);n.parent().hide();n.hide()}else{this.cashed[".combobox-options"].hide();this.cashed[".combobox-options li"].show();this.cashed[".combobox-options li"].children().show()}},_removeFromSelection:function(t){var n=e(t.target),r=n.data("value");this.element.find("option[value="+r+"]").prop("selected",!1);this._refreshSelected();this._trigger("remove")},_moveUp:function(){var e=this.cashed[".combobox-options"],t=this.cashed[".combobox-options li"],n=e.find(".selected");t.removeClass("selected");n.prevAll("li:visible").eq(0).length===0?n.siblings().last(":visible").addClass("selected"):n.prevAll("li:visible").eq(0).addClass("selected")},_moveDown:function(){var e=this.cashed[".combobox-options"],t=this.cashed[".combobox-options li"],n=e.find(".selected");t.removeClass("selected");n.nextAll("li:visible").eq(0).length===0?n.siblings().first(":visible").addClass("selected"):n.nextAll("li:visible").eq(0).addClass("selected")},_keyboarAction:function(e){var t=this.cashed[".combobox-options"],n=this.cashed[".combobox-options li"],r=t.find(".selected:visible"),i=t.find(".selected:hidden");if(e.keyCode===38)this._moveUp(e);else if(e.keyCode===40)this._moveDown(e);else if(e.keyCode===13){e.preventDefault();this._selectLi(r)}else this._autocomplete(e);r=t.find(".selected:visible");i=t.find(".selected:hidden");i.removeClass("selected");r.length===0&&n.filter(":visible").eq(0).addClass("selected")},_bindUIActions:function(){this.cashed[".combobox-options"].hide();this.options.isOpen&&this.cashed[".combobox-options"].show();this.options.hideElement&&this.element.hide();this.cashed[".selected-list li"].hide();this._on(this.cashed[".txtbox-btn"],{click:"_openClose"});this._on(this.cashed[".combobox-options li"],{click:"_selectLi"});this._on(this.cashed[".txtbox"],{keyup:"_keyboarAction"});this._on(this.element,{change:"_refreshSelected"});this._on(this.cashed[".selected-list li"],{click:"_removeFromSelection"})},val:function(){return this.element.val()},_setOptions:function(){this._superApply(arguments);this._refresh()},_setOption:function(e,t){this._super(e,t)},_casheElements:function(){var e=this.combobox,t=e.find(".txtbox-btn"),n=e.find(".txtbox"),r=e.siblings(".multicombobox-options"),i=r.children(),s=e.siblings(".selected-list"),o=s.find("li");this.cashed={".txtbox-btn":t,".combobox-options":r,".combobox-options li":i,".txtbox":n,".selected-list":s,".selected-list li":o}}})})(jQuery);